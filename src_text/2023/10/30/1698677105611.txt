ロックフリーのスタックの節を読んでるが、ノードの解放周りは難しいねぇ。まぁshared_ptr使ってロックを諦めるのが現実的か。